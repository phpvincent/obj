/**
 * ViewBox
 * @author Pavel Khoroshkov aka pgood
 * @link https://github.com/pgooood/viewbox
 */
(function(a){a.fn.viewbox=function(e){if(typeof(e)==="undefined"){e={}}e=a.extend({template:'<div class="viewbox-container"><div class="viewbox-body"><div class="viewbox-header"></div><div class="viewbox-content"></div><div class="viewbox-footer"></div></div></div>',loader:'<div class="loader"><div class="spinner"><div class="double-bounce1"></div><div class="double-bounce2"></div></div></div>',setTitle:true,margin:20,resizeDuration:400,openDuration:200,closeDuration:200,closeButton:true,navButtons:true,closeOnSideClick:true,nextOnContentClick:false},e);var p=a(this),q=a(e.template),m=a(e.loader),f=false,x=false,d,h=[];if(!a("#viewbox-sprite").length){a("body").get(0).insertAdjacentHTML("afterbegin",'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="viewbox-sprite" style="display:none"><symbol id="viewbox-close-icon" viewBox="0 0 50 50"><path d="M37.304 11.282l1.414 1.414-26.022 26.02-1.414-1.413z"/><path d="M12.696 11.282l26.022 26.02-1.414 1.415-26.022-26.02z"/></symbol><symbol id="viewbox-prev-icon" viewBox="0 0 50 50"><path d="M27.3 34.7L17.6 25l9.7-9.7 1.4 1.4-8.3 8.3 8.3 8.3z"/></symbol><symbol id="viewbox-next-icon" viewBox="0 0 50 50"><path d="M22.7 34.7l-1.4-1.4 8.3-8.3-8.3-8.3 1.4-1.4 9.7 9.7z"/></symbol></svg>')}function w(C,y){var D=u("body"),A=u("content"),z,B;if(C){A.width(C)}if(y){A.height(y)}if(!f){f=true;a("body").append(q);q.show();z=D.width();B=D.height();q.hide();q.fadeIn(e.openDuration)}else{z=D.width();B=D.height()}D.css({"margin-left":-z/2,"margin-top":-B/2})}function t(y){if(typeof(y)!=="undefined"){if(typeof(y)==="function"){h.push(y)}return}if(f){q.fadeOut(e.closeDuration,function(){q.detach();f=false;var z=[];while(h.length){z.push(h.shift())}while(z.length){z.shift()()}})}}function u(y){return q.find(".viewbox-"+y)}function k(y,z){u(y).html(z)}function g(){var y=-1;if(d){p.each(function(z){if(d.is(this)){y=z;return false}})}return y}function o(){if(p.length<=1){return}var y=g()+1;if(y>=p.length){y=0}p.eq(y).click()}function n(){if(p.length<=1){return}var y=g()-1;if(y<0){y=p.length-1}p.eq(y).click()}function r(y){return y.match(/(png|jpg|jpeg|gif)$/i)}function s(y){return y.match(/^#.+$/i)&&a(y).length}function b(y){return y.get(0).complete}function i(y){if(y){m.appendTo(u("body"))}else{m.detach()}}function l(A){var z=a('<div class="viewbox-button-default viewbox-button-'+A+'"></div>'),y=window.location.pathname+window.location.search+"#viewbox-"+A+"-icon";z.appendTo(q).get(0).insertAdjacentHTML("afterbegin",'<svg><use xlink:href="'+y+'"/></svg>');return z}function c(B,A){var D=a('<img class="viewbox-image" alt="">').attr("src",B);if(!b(D)){i(true)}k("content","");k("header",A);w();var E=u("body"),z=0,C=u("content"),y=window.setInterval(function(){if(!b(D)&&z<1000){z++;return}window.clearInterval(y);i(false);a("body").append(D);var G=E.width()-C.width()+e.margin*2,J=E.height()-C.height()+e.margin*2,H=a(window).width()-G,K=a(window).height()-J,F=D.width(),I=D.height();D.detach();if(F>H){I=I*H/F;F=H}if(I>K){F=F*K/I;I=K}x=true;E.animate({"margin-left":-(F+G)/2+e.margin,"margin-top":-(I+J)/2+e.margin},e.resizeDuration);C.animate({width:F,height:I},e.resizeDuration,function(){C.append(D);x=false})},b(D)?0:200)}function j(A,z){var y=a('<div class="viewbox-content-placeholder"></div>'),B=a(A);B.before(y);t(function(){y.before(B);y.detach()});k("content","");k("header",z);u("content").append(B);w("auto","auto")}function v(A){if(x){return}var z=A.attr("href"),y=e.setTitle&&A.attr("title")?A.attr("title"):"";if(!z){d=A;j(A,y)}else{if(r(z)){d=A;c(z,y)}else{if(s(z)){d=A;j(z,y)}}}}q.bind("viewbox.close",function(){t()});q.bind("viewbox.open",function(z,y){var A=function(){if(p.length){v(p.eq(y>=0&&y<p.length?y:0))}};if(f){t(A);t()}else{A()}});p.filter("a").click(function(){v(a(this));return false});u("body").click(function(y){y.stopPropagation();if(e.nextOnContentClick){o()}});if(e.closeButton){l("close").click(function(y){y.stopPropagation();t()})}if(e.navButtons&&p.length>1){l("next").click(function(y){y.stopPropagation();o()});l("prev").click(function(y){y.stopPropagation();n()})}if(e.closeOnSideClick){q.click(function(){t()})}return q}}(jQuery));